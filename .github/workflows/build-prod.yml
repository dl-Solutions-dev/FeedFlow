name: Build and Deploy Delphi to Production

on:
  push:
    branches: [ main ]  # DÃ©clenche le workflow sur les pushes vers main

jobs:
  build-and-deploy:
    runs-on: [self-hosted, dev]  # Cible le runner de production

    steps:
      - name: Checkout du code
        uses: actions/checkout@v4

      - name: Configuration de l'environnement Delphi
        shell: cmd
        run: |
          "C:\Program Files (x86)\Embarcadero\Studio\37.0\bin\rsvars.bat"
      
      - name: Configuration de l'environnement MSBuild
        shell: cmd
        run: |
          "C:\Program Files (x86)\Microsoft Visual Studio\18\BuildTools\Common7\Tools\VsDevCmd.bat"
          
      - name: Compilation en mode Release
        shell: cmd
        run: |
          "msbuild C:\Users\danyleblanc\Documents\DL-Projets\FeedFlow\src\FeedFlow.dproj /t:Build /p:Config=Release /p:Platform=Win64 /p:DCC_UsePackageOutputPath=true /m"

