@LayoutPage layouts/mainLayout

<div class="container">
<h1 class="text-center">@TITRE</h1>
<button
  class="btn btn-outline-primary"
  data-bs-toggle="modal"
  data-bs-target="#userSimulationModal"
>
  üë§ Simuler l‚Äôaffichage utilisateur
</button>
<br/>
<br/>
	<div id="overlay" class="overlay"></div>
	<div id="popup" class="popup">
	  <div class="popup-content">
		<span class="close" onclick="closePopup()">&times;</span>
		<!-- Case √† cocher visible tous contextes -->
		<input type="checkbox" id="AllContext" name="AllContext"/>
		<label for="AllContext">Visible par tout le monde</label>

		<!-- Zone des listes d√©roulantes avec labels -->
		<div class="dropdown-grid">
		  <div class="form-group">
			<label for="categories">B.U</label>
			<select id="categories" name="categories[]" multiple class="form-control">
			   @foreach Categories {
					<option value="@Categories.CATEGORY_ID">@LOOP.CATEGORY_NAME</Option>
				}
			</select>
		  </div>
		  <div class="form-group">
			<label for="sousCategories">Type Partenaire</label>
			<select id="sousCategories" name="sousCategories[]" multiple class="form-control">
				@foreach SubCategories {
					<option value="@SubCategories.SUBCATEGORy_ID">@LOOP.SUBCATEGORY_NAME</Option>
				}
			</select>
		  </div>
		  <div class="form-group">
			<label for="pays">Pays</label>
			<select id="pays" name="pays[]" multiple class="form-control">
				@foreach Country {
					<option value="@Country.COUNTRY_CODE">@LOOP.COUNTRY_NAME</Option>
				}
			</select>
		  </div>
		  <div class="form-group">
			<label for="langues">Langue</label>
			<select id="langues" name="langues[]" multiple class="form-control">
				@foreach Languages {
					<option value="@Languages.LANGUAGE_CODE">@LOOP.LANGUAGE_NAME</Option>
				}
			</select>
		  </div>
		</div>

		<br/>
		<button type="button"
				id="btnSaveContent"
				class="btn btn-primary"
				data-id="2"
				data-Feedid="@Form.FeedId"
				onclick="SendContext();">
		  Enregistrer
		</button>
	  </div>
	</div>

	<div id="ListNavigation">
		@import ListNavigation
	</div>
	<br/>
	<div id="TargetTable">
		@import FeedsTable
	</div>
	<button type="button"
			id="btnAddLine"
			class="btn btn-primary"
			hx-trigger="AddLine"
			hx-post="@env.resource/AddFeed?Session=@App.SessionNo"
			hx-target="#TableFeeds"
			hx-swap="beforeend"
			onClick="let addingLine = document.querySelector('.addingLine')
					if(!addingLine) {
						htmx.trigger(this, 'AddLine')
					}">
	Ajouter un fil d'informations
	</button>
	<button type="button"
					id="btnPrec"
					class="btn btn-primary"
			>
			Retour
	</button>
	
	<script>
		document.body.addEventListener('htmx:afterRequest', function(evt) {
			if (evt.detail.requestConfig.path.startsWith("@env.resource/@pages.ActionPagination")) {
				// Une fois la premi√®re requ√™te termin√©e, d√©clencher la deuxi√®me requ√™te
				htmx.ajax("GET", "@env.resource/@pages.ActionList?Session=@App.SessionNo&Page=1@if (pages.UrlParameters <> '') {&@pages.UrlParameters}", "#TargetTable");
			}
		});
	</script>
</div>

<div
  class="modal fade"
  id="userSimulationModal"
  tabindex="-1"
  aria-labelledby="userSimulationModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title" id="userSimulationModalLabel">
          Simulation de l‚Äôaffichage utilisateur
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <p class="text-muted mb-4">
          Pr√©visualisez la page comme si elle √©tait consult√©e par un utilisateur avec les param√®tres suivants.
        </p>

        <form id="userSimulationForm">
          <div class="mb-3">
            <label class="form-label">Cat√©gorie</label>
            <select class="form-select" name="admin_category" id="admin_category" required>
				@foreach Categories {
				<option value="@Categories.CATEGORY_ID">@LOOP.CATEGORY_NAME</Option>
				}
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">Sous-cat√©gorie</label>
            <select class="form-select" name="admin_subcategory" id="admin_subcategory" required>
				@foreach SousCategories {
				<option value="@SousCategories.SUBCATEGORY_ID">@LOOP.SUBCATEGORY_NAME</Option>
				}
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">Pays</label>
            <select class="form-select" name="admin_country" id="admin_country" required>
				@foreach Pays {
				<option value="@Pays.COUNTRY_CODE">@LOOP.COUNTRY_NAME</Option>
				}
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">Langue</label>
            <select class="form-select" name="admin_lang" id="admin_lang" required>
				@foreach Langues {
				<option value="@Langues.LANGUAGE_CODE">@LOOP.LANGUAGE_NAME</Option>
				}
            </select>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">
          Annuler
        </button>
        <button class="btn btn-primary" onclick="openSimulation()">
          üëÅ Ouvrir en mode simulation
        </button>
      </div>

    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/js/tom-select.complete.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/css/tom-select.css" rel="stylesheet">

<script src="@env.resource/static/js/ScriptsFeeds.js"></script>