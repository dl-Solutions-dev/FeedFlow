<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Colonnes personnalisables</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    table { border-collapse: collapse; width: 60%; margin-top: 1em; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }

    /* Styles pour la popup */
    .modal {
      display: none; /* cachée par défaut */
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 6px;
      min-width: 250px;
    }
    .modal-content h3 { margin-top: 0; }
    .close-btn {
      float: right;
      cursor: pointer;
      font-weight: bold;
    }
	.btn-icon {
    background-color: #007BFF; /* bleu moderne */
    color: white;
    border: none;
    padding: 10px 16px;
    font-size: 16px;
    border-radius: 6px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: background-color 0.3s;
  }
  .btn-icon:hover {
    background-color: #0056b3;
  }
  </style>
</head>
<body>
  <button id="openModal" class="btn-icon">
	<i class="fa-solid fa-sliders"></i> Choisir les colonnes
  </button>

  <div id="columnModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" id="closeModal">&times;</span>
      <h3>Colonnes à afficher</h3>
      <div id="checkboxContainer"></div>
    </div>
  </div>

  <table id="myTable">
    <thead>
      <tr>
        <th>Nom</th>
        <th>Âge</th>
        <th>Ville</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>Paul</td><td>32</td><td>Paris</td></tr>
      <tr><td>Marie</td><td>25</td><td>Lyon</td></tr>
      <tr><td>Luc</td><td>40</td><td>Bordeaux</td></tr>
    </tbody>
  </table>

  <script>
    const table = document.getElementById("myTable");
    const modal = document.getElementById("columnModal");
    const openBtn = document.getElementById("openModal");
    const closeBtn = document.getElementById("closeModal");
    const checkboxContainer = document.getElementById("checkboxContainer");

    // Ouvrir / fermer la popup
    openBtn.onclick = () => modal.style.display = "flex";
    closeBtn.onclick = () => modal.style.display = "none";
    window.onclick = (e) => { if (e.target === modal) modal.style.display = "none"; };

    // Générer les cases à cocher automatiquement
    document.addEventListener("DOMContentLoaded", () => {
      const headers = table.querySelectorAll("th");
      const saved = JSON.parse(localStorage.getItem("visibleCols") || "[]");

      headers.forEach((th, index) => {
        const label = document.createElement("label");
        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.dataset.col = index;
        cb.checked = saved.length === 0 ? true : saved.includes(index);
        label.appendChild(cb);
        label.append(" " + th.textContent);
        checkboxContainer.appendChild(label);
        checkboxContainer.appendChild(document.createElement("br"));

        // appliquer visibilité initiale
        toggleColumn(table, index, cb.checked);

        cb.addEventListener("change", () => {
          toggleColumn(table, index, cb.checked);
          const visible = Array.from(checkboxContainer.querySelectorAll("input"))
            .filter(c => c.checked)
            .map(c => parseInt(c.dataset.col, 10));
          localStorage.setItem("visibleCols", JSON.stringify(visible));
        });
      });
    });

    function toggleColumn(table, colIndex, show) {
      table.querySelectorAll("th")[colIndex].style.display = show ? "" : "none";
      table.querySelectorAll("tbody tr").forEach(row => {
        row.cells[colIndex].style.display = show ? "" : "none";
      });
    }
  </script>
</body>
</html>
