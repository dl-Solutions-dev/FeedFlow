@LayoutPage layouts/mainLayout

<div class="container-fluid h-100">
<h1 class="text-center">@Form.TITRE</h1>
<br/>
	<div class="row h-100 flex-nowrap">
		<div class="col flex-grow-1 bg-light p-3">

			<div id="overlay" class="overlay"></div>
			<div id="popup" class="popup">
			  <div class="popup-content">
				<span class="close" onclick="closePopup()">&times;</span>
				
				<div id="editor-container" style="height: 400px;"></div>
				<br/>

				<!-- Zone des listes dÃ©roulantes avec labels -->
				<div class="dropdown-grid">
				  <div class="form-group">
					<label for="categories">B.U</label>
					<select id="categories" name="categories[]" multiple class="form-control">
					   @foreach Categories {
							<option value="@Categories.ID_CATEGORIE">@LOOP.LIBELLE</Option>
						}
				    </select>
				  </div>
				  <div class="form-group">
					<label for="sousCategories">Type Partenaire</label>
					<select id="sousCategories" name="sousCategories[]" multiple class="form-control">
						@foreach SousCategories {
							<option value="@SousCategories.ID_SOUS_CATEGORIE">@LOOP.LIBELLE</Option>
						}
					</select>
				  </div>
				  <div class="form-group">
					<label for="pays">Pays</label>
					<select id="pays" name="pays[]" multiple class="form-control">
						@foreach Pays {
							<option value="@Pays.CODE_PAYS">@LOOP.LIBELLE</Option>
						}
					</select>
				  </div>
				  <div class="form-group">
					<label for="langues">Langue</label>
					<select id="langues" name="langues[]" multiple class="form-control">
						@foreach Langues {
							<option value="@Langues.CODE_LANGUE">@LOOP.LIBELLE</Option>
						}
					</select>
				  </div>
				</div>

				<br/>
				<button type="button"
						id="btnSaveContent"
						class="btn btn-primary"
						data-id="2"
						data-Feedid="@Form.FeedId"
						onclick="setLastEditedFeed(this); SendContent();">
				  Enregistrer
				</button>
			  </div>
			</div>


			
			<div style="display:none" id="FeedId">@Form.FEEDID</div>
			
			<!--<form action="/UploadTemplate?FeedId=@Form.FEEDID" method="post" enctype="multipart/form-data">
			<input type="file" name="file">
			<button type="submit">Envoyer</button>
			</form>-->
			<div class="upload-container">
			
			<h3 class="upload-title">Uploader un template d'affichage</h3>
			
			<div class="upload-zone" id="uploadZone">
				Glissez-dÃ©posez un fichier ou cliquez pour sÃ©lectionner ðŸ“‚
				<input type="file" id="fileInput" hidden>
			</div>

			<!-- Affichage du fichier sÃ©lectionnÃ© -->
			  <div class="file-info" id="file-info" style="display:none;">
				<span class="material-icons">description</span>
				<span class="file-name" id="file-name"></span>
				<span class="file-size" id="file-size"></span>
				<button type="button" class="remove-file" id="remove-file">âœ•</button>
			  </div>
			  
			<div id="preview">Fichier template : <span id="TemplateName">@Form.TemplateName</span></div>
			<div class="progress">
				<div class="progress-bar" id="progressBar"></div>
			</div>
			</div>
			


			<div id="ListNavigation">
				@import ListNavigation
			</div>
			<br/>
			<div id="TargetTable">
				@import NewsTable
			</div>
			<button type="button" 
					id="btnAddLine"
					class="btn btn-primary" 
					hx-trigger="AddLine"
					hx-post="@env.resource/AddNews?FeedId=@Form.FEEDID" 
					hx-target="#TableNews" 
					hx-swap="beforeend"
					onClick="let addingLine = document.querySelector('.addingLine')
							if(!addingLine) {
								htmx.trigger(this, 'AddLine')
							}">
			Ajouter une news
			</button>

			<script>
				document.body.addEventListener('htmx:afterRequest', function(evt) {
					if (evt.detail.requestConfig.path.startsWith("@env.resource/@pages.ActionPagination")) {
						// Une fois la premiÃ¨re requÃªte terminÃ©e, dÃ©clencher la deuxiÃ¨me requÃªte
						htmx.ajax("GET", "@env.resource/@pages.ActionList?FeedId=@Form.FeedId&Page=1@if (pages.UrlParameters <> '') {&@pages.UrlParameters}", "#TargetTable");
					}
				});
				
				document.addEventListener("keydown", function(event) {
				  if (event.key === "Escape") {
					closePopup();
				  }
				});

			</script>

		</div>

		<div 
			class="col-auto bg-white border-start p-3" 
			style="width: 400px;" 
			id="sidePanel"
			hx-post="/Show?idFeed=@Form.FeedId&Template=ShowNews.html"
			hx-trigger="load"
			hx-sap="innerHTML"
			>
		
		</div>
		<!--</div>-->
	</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/js/tom-select.complete.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/css/tom-select.css" rel="stylesheet">
<script src="@env.resource/static/js/ScriptUpload.js"></script>

<script>
  new TomSelect("#categories",   { plugins: ['remove_button'], maxItems: null });
  new TomSelect("#sousCategories",   { plugins: ['remove_button'], maxItems: null });
  new TomSelect("#pays",   { plugins: ['remove_button'], maxItems: null });
  new TomSelect("#langues",   { plugins: ['remove_button'], maxItems: null });
</script>